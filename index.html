<!DOCTYPE html>
<html manifest="offline.appcache">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="manifest" href="app.manifest" />
    <title>Ninja - Endless Runner Game</title>
    <!-- Responsive viewport for mobile scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <style type="text/css">
        body { 
            background-color: black; 
            color: white; 
            margin: 0; 
            padding: 0;
            overflow: hidden;
        }
        #c2canvasdiv {
            position: absolute;
            left: 0; top: 0; right: 0; bottom: 0;
            width: 100vw;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        canvas { 
            display: block;
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw;
            max-height: 100vh;
            background: #000;
            -ms-touch-action: none;
            touch-action: none;
        }
        /* On-screen controls for mobile */
        #mobile-controls {
            display: none;
            position: fixed;
            bottom: 4vw; left: 0; right: 0;
            width: 100vw;
            pointer-events: none;
            z-index: 10;
        }
        .control-btn {
            pointer-events: auto;
            width: 18vw;
            height: 18vw;
            max-width: 90px;
            max-height: 90px;
            border-radius: 50%;
            margin: 0 7vw;
            font-size: 2em;
            background: rgba(255,255,255,0.7);
            color: #222;
            border: none;
            box-shadow: 0 2px 8px #0008;
            text-align: center;
            vertical-align: middle;
            line-height: 18vw;
            user-select: none;
        }
        /* Portrait warning overlay */
        #rotate-warning {
            display: none;
            position: fixed;
            z-index: 100;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.9);
            color: #fff;
            text-align: center;
            align-items: center;
            justify-content: center;
            font-size: 6vw;
            padding-top: 40vh;
        }
        /* Tap to start overlay for orientation lock */
        #tap-to-start {
            display: none;
            position: fixed;
            z-index: 200;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.92);
            color: #fff;
            text-align: center;
            align-items: center;
            justify-content: center;
            font-size: 7vw;
            font-weight: bold;
            padding-top: 40vh;
            cursor: pointer;
        }
        @media (orientation: portrait) {
            #rotate-warning { display: flex; }
        }
        @media (pointer: coarse) {
            #mobile-controls { display: flex; justify-content: center; }
            #tap-to-start { display: flex; }
        }
    </style>
</head> 
<body> 
    <div id="fb-root"></div>
    <div style="text-align: center;">
        <div id="c2canvasdiv">
            <canvas id="c2canvas"></canvas>
        </div>
    </div>

    <!-- Mobile on-screen controls -->
    <div id="mobile-controls">
        <button class="control-btn" id="jump-btn">▲<br/>Jump</button>
        <button class="control-btn" id="slide-btn">▼<br/>Slide</button>
    </div>
    <!-- Portrait orientation warning -->
    <div id="rotate-warning">
        Please rotate your device<br/>for the best experience!
    </div>
    <!-- Tap to start overlay (for orientation lock) -->
    <div id="tap-to-start">
        Tap to Start<br/>
        <span style="font-size:4vw;font-weight:normal;display:block;margin-top:2vw;">(Switching to landscape...)</span>
    </div>

    <script src="jquery-2.1.1.min.js"></script>
    <script src="c2runtime.js"></script>
    <script>
        // Responsive canvas sizing
        function resizeCanvas() {
            var w = window.innerWidth;
            var h = window.innerHeight;
            var $canvas = $('#c2canvas');
            $canvas.attr('width', w);
            $canvas.attr('height', h);
        }
        window.addEventListener('resize', resizeCanvas, false);
        window.addEventListener('orientationchange', resizeCanvas, false);
        $(resizeCanvas);

        // Orientation lock on mobile with gesture
        function isMobile() {
            return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
        }

        function tryLockLandscape() {
            var orientation = (screen.orientation || screen.mozOrientation || screen.msOrientation);
            if (orientation && orientation.lock) {
                orientation.lock('landscape').catch(function(e){
                    // Ignore or show fallback
                });
            }
        }

        // Show tap-to-start if mobile and in portrait
        function showTapToStartIfNeeded() {
            var tapOverlay = document.getElementById('tap-to-start');
            if(isMobile() && window.innerWidth < window.innerHeight) {
                tapOverlay.style.display = 'flex';
            } else {
                tapOverlay.style.display = 'none';
            }
        }

        // Only start game after user taps (and try to lock orientation)
        let crStarted = false;
        document.getElementById('tap-to-start').addEventListener('click', function(){
            tryLockLandscape();
            this.style.display = 'none';
            if(!crStarted){
                $(document).ready(function () {
                    cr_createRuntime("c2canvas");
                });
                crStarted = true;
            }
        });

        // If not mobile, or already landscape: start game immediately
        $(function(){
            if(!isMobile() || window.innerWidth > window.innerHeight){
                cr_createRuntime("c2canvas");
                crStarted = true;
            } else {
                showTapToStartIfNeeded();
            }
        });

        // Recheck on resize/orientation
        window.addEventListener('resize', showTapToStartIfNeeded);
        window.addEventListener('orientationchange', showTapToStartIfNeeded);
        setTimeout(showTapToStartIfNeeded, 100);

        // Visibility handling
        function onVisibilityChanged() {
            if (document.hidden || document.mozHidden || document.webkitHidden || document.msHidden)
                cr_setSuspended(true);
            else
                cr_setSuspended(false);
        }
        document.addEventListener("visibilitychange", onVisibilityChanged, false);
        document.addEventListener("mozvisibilitychange", onVisibilityChanged, false);
        document.addEventListener("webkitvisibilitychange", onVisibilityChanged, false);
        document.addEventListener("msvisibilitychange", onVisibilityChanged, false);

        // Show/hide rotate warning on mobile portrait
        function checkOrientation() {
            var warning = document.getElementById('rotate-warning');
            if(window.innerWidth < window.innerHeight) {
                warning.style.display = "flex";
            } else {
                warning.style.display = "none";
            }
        }
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
        setTimeout(checkOrientation, 100);

        // Mobile controls: dispatch key events for game compatibility
        function simulateKey(keyCode) {
            var e = $.Event("keydown");
            e.which = keyCode;
            e.keyCode = keyCode;
            $(document).trigger(e);
        }
        document.getElementById('jump-btn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            // Simulate spacebar (jump)
            simulateKey(32);
        });
        document.getElementById('slide-btn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            // Simulate down arrow (slide)
            simulateKey(40);
        });
    </script>
</body> 
</html>
